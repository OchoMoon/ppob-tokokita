<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PPOB - TokoKita</title>
<link rel="manifest" href="/manifest.json">
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js');
  }
</script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0f1724;--card:#0b1220;--muted:#9aa6b2;
  --accent1:#7c5cff;--accent2:#00d4ff;
  --success:#22c55e;--danger:#ef4444;
  font-family:'Inter',system-ui,Segoe UI,Roboto,Arial,sans-serif;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,var(--bg),#071024);color:#e6eef6;min-height:100vh}
.wrap{max-width:1100px;margin:32px auto;padding:24px}
header{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:52px;height:52px;display:grid;place-items:center;border-radius:12px;background:linear-gradient(135deg,var(--accent1),var(--accent2));font-weight:800}
h1{font-size:18px;margin:0} p.lead{margin:0;color:var(--muted);font-size:13px}
.saldo-info{display:flex;align-items:center;gap:10px;font-size:14px;margin-top:8px}
.saldo-info button{padding:4px 10px;font-size:13px;border:0;border-radius:8px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021023;font-weight:600;cursor:pointer}
main{display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:24px}
.panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;padding:16px}
.searchbar{display:flex;gap:12px}
.searchbar input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;margin-top:16px}
.card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 8px 24px rgba(2,6,23,0.6)}
.card h3{margin:0;font-size:15px}.meta{font-size:13px;color:var(--muted);margin-top:6px}
.price{margin-top:10px;font-weight:700}
.btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021023;font-weight:600;cursor:pointer}
aside .panel{position:sticky;top:32px}
.cart-item{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);margin-bottom:10px}
.cart-footer{display:flex;flex-direction:column;gap:8px;margin-top:12px}
.total{display:flex;justify-content:space-between;font-weight:700}
.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:10px;color:var(--muted);cursor:pointer}
.page{display:none}.page.active{display:block}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--card);display:flex;justify-content:space-around;border-top:1px solid rgba(255,255,255,0.06);padding:8px 0;z-index:99}
.bottom-nav button{flex:1;background:none;border:0;color:var(--muted);font-weight:600;cursor:pointer}
.bottom-nav button.active{color:var(--accent2)}
label{display:block;font-size:13px;margin:6px 0}
input[type=text],select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.muted{color:var(--muted);font-size:13px}
.broadcast-item{background:var(--card);padding:12px;border-radius:10px;margin-bottom:12px}
.broadcast-item h4{margin:0 0 4px 0;font-size:15px}
.broadcast-item p{margin:0;font-size:13px;color:var(--muted)}
@media(max-width:880px){main{grid-template-columns:1fr;}.wrap{padding:16px}}
</style>
</head>
<body>
<div class="wrap">

  <!-- ===== HOME ===== -->
  <div id="page-home" class="page active">
    <header>
      <div class="brand">
        <div class="logo">P</div>
        <div><h1>PPOB Mini</h1><p class="lead">Pulsa, listrik, PDAM, top-up game, dll</p></div>
      </div>
      <div class="saldo-info">
        Saldo: <span id="saldo">Rp0</span>
        <button id="btn-topup">Isi Saldo</button>
        <button class="btn" id="open-cart">üßæ Keranjang (<span id="cart-count">0</span>)</button>
      </div>
    </header>

    <main>
      <section>
        <div class="panel">
          <div class="searchbar">
            <input id="q" placeholder="Cari layanan" />
            <select id="filter">
              <option value="all">Semua</option>
              <option value="pulsa">Pulsa</option>
              <option value="listrik">Listrik</option>
              <option value="data">Paket Data</option>
              <option value="pdam">PDAM</option>
              <option value="game">Top Up Game</option>
            </select>
          </div>
          <div class="products" id="products"></div>
        </div>
      </section>

      <aside>
        <div class="panel">
          <h3>Ringkasan Pesanan</h3>
          <p class="muted" id="empty-note">Keranjang kosong.</p>
          <div id="cart-list"></div>
          <div class="cart-footer">
            <div class="total"><span>Total</span><span id="cart-total">Rp0</span></div>
            <div style="display:flex;gap:8px">
              <button class="ghost" id="clear-cart">Bersihkan</button>
              <button class="btn" id="checkout-btn">Bayar</button>
            </div>
          </div>
        </div>
      </aside>
    </main>
  </div>

  <!-- ===== BROADCAST / SIARAN ===== -->
  <div id="page-broadcast" class="page">
    <header>
      <div class="brand"><div class="logo">üîî</div>
        <div><h1>Siaran</h1><p class="lead">Info & Pengumuman</p></div>
      </div>
    </header>
    <main>
      <div id="broadcast-list"></div>
    </main>
  </div>

  <!-- ===== SETTINGS ===== -->
  <div id="page-settings" class="page">
    <header><div class="brand"><div class="logo">‚öôÔ∏è</div><div><h1>Pengaturan</h1></div></div></header>
    <main><div class="panel" style="max-width:600px;margin:auto">
      <label><input type="checkbox" id="dark-toggle" checked> Mode Gelap</label>
    </div></main>
  </div>
</div>

<!-- Bottom nav -->
<nav class="bottom-nav">
  <button id="nav-home" class="active">üè† Home</button>
  <button id="nav-broadcast">üîî Siaran</button>
  <button id="nav-settings">‚öôÔ∏è Pengaturan</button>
</nav>

<!-- Modal Checkout -->
<div class="modal-backdrop" id="modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);align-items:center;justify-content:center;">
  <div class="panel" style="max-width:560px;width:90%;">
    <h2>Checkout</h2>
    <form id="checkout-form">
      <label>Nama Pembeli <input id="cust-name" required></label>
      <label>No. HP Pembeli <input id="cust-phone" required></label>
      <label>Email (opsional) <input id="cust-email"></label>
      <hr>
      <h3>Data Penerima / Tujuan</h3>
      <label>Nama / ID Penerima <input id="recv-name" required placeholder="Misal: ID Game / Nomor tujuan"></label>
      <label>Keterangan (opsional) <input id="recv-note" placeholder="Catatan tambahan"></label>
      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn" type="submit">Konfirmasi & Bayar</button>
        <button type="button" class="ghost" id="modal-cancel">Batal</button>
      </div>
    </form>
  </div>
</div>

<script>
// ======= Data produk =======
const PRODUCTS=[
 {id:'pln20',title:'Token PLN 20k',cat:'listrik',price:20000,meta:'Token 20.000'},
 {id:'pulsa10',title:'Pulsa Telkomsel 10k',cat:'pulsa',price:10000,meta:'Pulsa reguler'},
 {id:'data5',title:'Paket Data 5GB',cat:'data',price:35000,meta:'5GB/30hari'},
 {id:'pdam1',title:'PDAM Bulanan',cat:'pdam',price:75000,meta:'Tagihan air'},
 {id:'ml-diamond',title:'Top Up ML 86 Diamonds',cat:'game',price:25000,meta:'Mobile Legends'},
 {id:'ff-diamond',title:'Top Up Free Fire 100 Diamonds',cat:'game',price:28000,meta:'Free Fire'}
];

// ======= Data Siaran (edit sesuai kebutuhan) =======
const BROADCASTS=[
  {title:'Update Aplikasi',body:'Sekarang mendukung pembayaran otomatis dan top-up game lebih cepat!',date:'2025-09-22'},
  {title:'Promo Spesial',body:'Diskon 10% untuk isi pulsa minimal 50k selama minggu ini.',date:'2025-09-21'}
];

let cart=[];const rupiah=n=>'Rp'+n.toLocaleString('id-ID');

// ===== Saldo virtual =====
let saldo = parseInt(localStorage.getItem('saldo')||'0');
function updateSaldo(){
  document.getElementById('saldo').textContent = rupiah(saldo);
  localStorage.setItem('saldo', saldo);
}
updateSaldo();
document.getElementById('btn-topup').onclick = ()=>{
  const amount = parseInt(prompt('Masukkan nominal isi saldo:', '50000'))||0;
  if(amount>0){ saldo += amount; updateSaldo(); alert('Saldo bertambah '+rupiah(amount)); }
};

// ===== Produk & Keranjang =====
function renderProducts(filter='all',q=''){
  const el=document.getElementById('products');el.innerHTML='';
  PRODUCTS.filter(p=>(filter==='all'||p.cat===filter)&&
    (p.title.toLowerCase().includes(q.toLowerCase())||p.meta.toLowerCase().includes(q.toLowerCase()))
  ).forEach(p=>{
    const c=document.createElement('div');c.className='card';
    c.innerHTML=`<h3>${p.title}</h3>
      <div class="meta">${p.meta}</div>
      <div class="price">${rupiah(p.price)}</div>
      <button class="btn add" data-id="${p.id}">Pesan</button>`;
    el.appendChild(c);
  });
  document.querySelectorAll('.add').forEach(b=>b.onclick=()=>addToCart(b.dataset.id));
}
function addToCart(id){
  const p=PRODUCTS.find(x=>x.id===id);
  if(!p)return;
  const ex=cart.find(i=>i.id===id);
  ex?ex.qty++:cart.push({id,qty:1,product:p});
  renderCart();
}
function renderCart(){
  const list=document.getElementById('cart-list');
  list.innerHTML='';
  if(!cart.length){
    document.getElementById('empty-note').style.display='block';
    document.getElementById('cart-total').textContent='Rp0';
    document.getElementById('cart-count').textContent='0';
    return;
  }
  document.getElementById('empty-note').style.display='none';
  let total=0;
  cart.forEach(it=>{
    total+=it.qty*it.product.price;
    const d=document.createElement('div');d.className='cart-item';
    d.innerHTML=`<div style="flex:1">
        <div>${it.product.title}</div>
        <div class="muted">${rupiah(it.product.price)} x ${it.qty}</div></div>
      <button class="ghost rm" data-id="${it.id}">Hapus</button>`;
    list.appendChild(d);
  });
  document.getElementById('cart-total').textContent=rupiah(total);
  document.getElementById('cart-count').textContent=cart.reduce((a,b)=>a+b.qty,0);
  list.querySelectorAll('.rm').forEach(b=>b.onclick=()=>{cart=cart.filter(i=>i.id!==b.dataset.id);renderCart();});
}
document.getElementById('clear-cart').onclick=()=>{cart=[];renderCart();};

// ===== Checkout modal =====
const modal=document.getElementById('modal');
document.getElementById('checkout-btn').onclick=()=>{if(cart.length)modal.style.display='flex';else alert('Keranjang kosong');};
document.getElementById('modal-cancel').onclick=()=>modal.style.display='none';
document.getElementById('checkout-form').onsubmit=e=>{
  e.preventDefault();
  const total = cart.reduce((a,b)=>a + b.qty * b.product.price, 0);
  if(saldo < total){
    alert('Saldo tidak cukup. Saldo Anda '+rupiah(saldo)+' sementara total '+rupiah(total));
    return;
  }
  saldo -= total;
  updateSaldo();

  // === Kirim ke Telegram ===
  const TELEGRAM_TOKEN = 'ISI_TOKEN_BOT_ANDA';
  const CHAT_ID = 'ISI_CHAT_ID_ANDA';

  const nama = document.getElementById('cust-name').value;
  const hp   = document.getElementById('cust-phone').value;
  const email= document.getElementById('cust-email').value || '-';
  const tujuan = document.getElementById('recv-name').value;
  const note   = document.getElementById('recv-note').value || '-';
  const items = cart.map(i => `${i.product.title} x${i.qty} (${rupiah(i.product.price*i.qty)})`).join('\n');

  const message = `üõí *Pesanan Baru*\n`+
    `Nama: ${nama}\nHP: ${hp}\nEmail: ${email}\nTujuan: ${tujuan}\nCatatan: ${note}\n\n`+
    `Produk:\n${items}\n\nTotal: *${rupiah(total)}*`;

  fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ chat_id: CHAT_ID, text: message, parse_mode: 'Markdown' })
  }).catch(err => console.error('Telegram error:', err));
  // === End kirim Telegram ===

  alert('Pesanan sukses! Saldo tersisa: '+rupiah(saldo));
  cart=[];renderCart();modal.style.display='none';
};

// ===== Siaran =====
function renderBroadcasts(){
  const b=document.getElementById('broadcast-list');
  b.innerHTML='';
  BROADCASTS.forEach(x=>{
    const d=document.createElement('div');
    d.className='broadcast-item';
    d.innerHTML=`<h4>${x.title} <span class="muted">(${x.date})</span></h4>
                 <p>${x.body}</p>`;
    b.appendChild(d);
  });
}

// ===== Navigasi =====
const pages={
  home:document.getElementById('page-home'),
  broadcast:document.getElementById('page-broadcast'),
  settings:document.getElementById('page-settings')
};
function show(p){
  for(const k in pages)pages[k].classList.remove('active');
  pages[p].classList.add('active');
  document.querySelectorAll('.bottom-nav button').forEach(b=>b.classList.remove('active'));
  document.getElementById('nav-'+p).classList.add('active');
}
document.getElementById('nav-home').onclick=()=>show('home');
document.getElementById('nav-broadcast').onclick=()=>{show('broadcast');renderBroadcasts();};
document.getElementById('nav-settings').onclick = () => show('settings');

// ===== Dark mode toggle =====
document.getElementById('dark-toggle').onchange = e => {
  document.body.style.background = e.target.checked
    ? 'linear-gradient(180deg,var(--bg),#071024)'
    : '#f5f5f5';
  document.body.style.color = e.target.checked ? '#e6eef6' : '#111';
};

// ===== Filter & Pencarian =====
document.getElementById('filter').onchange = () => {
  renderProducts(
    document.getElementById('filter').value,
    document.getElementById('q').value
  );
};
document.getElementById('q').oninput = () => {
  renderProducts(
    document.getElementById('filter').value,
    document.getElementById('q').value
  );
};

// ===== Inisialisasi =====
renderProducts();
renderCart();
</script>
</body>
</html>
